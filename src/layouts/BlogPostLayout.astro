---
import {
  differenceInYears,
  differenceInDays,
  format,
  formatDistanceToNow,
  formatISO,
} from "date-fns";
import readingTime from "reading-time";
import ReadingTime from "../components/ReadingTime.astro";
import Layout from "./Layout.astro";
import Links from "../components/Links.astro";
import { getSocialImageForBlogPost } from "@/utils/blog";
import type { CollectionEntry } from "astro:content";
import Icon from "@/components/Icon.astro";

type Props = {
  post: CollectionEntry<"blog">;
};

const { post } = Astro.props;

const {
  body,
  data: { title, date },
} = post;

const showDateWarning = differenceInYears(new Date(), date) >= 2;
const showRelativeTime = differenceInDays(new Date(), date) >= 1;
---

<Layout
  style="blog-post"
  title={title}
  socialImage={{
    url: getSocialImageForBlogPost(title),
    width: 2048,
    height: 1170,
  }}
>
  <div class="mx-auto max-w-full sm:max-w-lg md:max-w-2xl">
    <div class="mb-8">
      <h1 class="mb-3 font-medium text-2xl sm:text-4xl">{title}</h1>
      <time datetime={formatISO(date)} class="mb-1 block sm:mb-0 sm:inline">
        {format(date, "MMMM do, yyyy")}
        {
          showRelativeTime && (
            <span class="text-gray-600 dark:text-gray-400">
              ({formatDistanceToNow(date, { addSuffix: true })})
            </span>
          )
        }
      </time>
      <span
        class="hidden ml-1 mr-0.5 text-gray-500 sm:inline dark:text-gray-400"
        >&middot;</span
      >
      {body && <ReadingTime minutes={readingTime(body).minutes} />}
    </div>
    {
      showDateWarning && (
        <div class="mb-8 py-3 px-4 rounded-md bg-yellow-100 text-yellow-900 dark:bg-transparent dark:border-2 dark:border-yellow-500 dark:text-white">
          <Icon
            icon="fa7-solid--clock"
            inline={true}
            class="mr-1 text-yellow-900/30 dark:text-white/30"
          />
          This post is more than{" "}
          <strong class="font-medium">
            {differenceInYears(new Date(), date)} years old.
          </strong>
        </div>
      )
    }
    <article
      class="mb-12 prose prose-neutral md:prose-lg md:prose-pre:leading-normal dark:prose-invert"
    >
      <slot />
    </article>
    <div>
      <p class="mb-4 text-gray-600 dark:text-gray-400">
        Hey, thanks for reading all the way through! If you'd like to get in
        touch or keep up with what I'm working on, here's where you can find me
        on the usual places.
      </p>
      <Links align="left" condensed={true} />
    </div>
  </div>
</Layout>
